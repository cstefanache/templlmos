
<html>
<head>
<script>
window.os = {
    apps: {}
};



(function() {
    // Load filesystem from localStorage, if it exists, otherwise initialize it as an empty object
    var filesystem = JSON.parse(localStorage.getItem('filesystem')) || {};
    
    // Define fs methods on window.os
    window.os = window.os || {};
    window.os.fs = {
        sync: function() {
            localStorage.setItem('filesystem', JSON.stringify(filesystem));
        },
        readPath: function(path) {
            path = path[0] === '/' ? path.slice(1) : path;  // Remove leading '/' if exists
            var pathArray = path.split('/');
            var current = filesystem;
            for (var i = 0; i < pathArray.length; i++) {
                if (current[pathArray[i]] === undefined) {
                    return undefined;  // Path not found
                } else {
                    current = current[pathArray[i]];  // Traverse down the path
                }
            }
            return current;  // Return content at path
        },
        write: function(path, content) {
            path = path[0] === '/' ? path.slice(1) : path;  // Remove leading '/' if exists
            var pathArray = path.split('/');
            var current = filesystem;
            for (var i = 0; i < pathArray.length - 1; i++) {  // Do not traverse to last element, we will assign content there
                if (current[pathArray[i]] === undefined) {
                    current[pathArray[i]] = {};  // Create path if it does not exist
                }
                current = current[pathArray[i]];  // Traverse down the path
            }
            current[pathArray[pathArray.length - 1]] = content;  // Assign content to last element in path
            this.sync();  // Save filesystem to localStorage
        },
        ls: function(path) {
            path = path[0] === '/' ? path.slice(1) : path;  // Remove leading '/' if exists
            var current = filesystem;
            if (path) {
                var pathArray = path.split('/');
                for (var i = 0; i < pathArray.length; i++) {
                    if (current[pathArray[i]] === undefined) {
                        return undefined;  // Path not found
                    } else {
                        current = current[pathArray[i]];  // Traverse down the path
                    }
                }
            }
            return Object.keys(current);  // Return entries at path
        },
        mkdir: function(path, dirName) {
            this.write(path + '/' + dirName, {});  // Write an empty directory at path
        },
        rm: function(path) {
            path = path[0] === '/' ? path.slice(1) : path;  // Remove leading '/' if exists
            var pathArray = path.split('/');
            var current = filesystem;
            for (var i = 0; i < pathArray.length - 1; i++) {  // Do not traverse to last element, we will remove it here
                if (current[pathArray[i]] === undefined) {
                    return;  // Path not found, do nothing
                } else {
                    current = current[pathArray[i]];  // Traverse down the path
                }
            }
            delete current[pathArray[pathArray.length - 1]];  // Remove last element in path
            this.sync();  // Save filesystem to localStorage
        },
        isFile: function(path) {
            var content = this.readPath(path);
            return typeof content === 'string';  // Return true if content at path is a string
        }
    };
})();



if (typeof window.os === "undefined") {
    window.os = {};
}

window.os.gui = {};



(function() {
    if (!window.os || !window.os.gui) {
        window.os = window.os || {};
        window.os.gui = window.os.gui || {};
    }
    
    window.os.gui.utils = {
        setSizeAndCenter: function (root, width, height) {
            root.style.width = width + 'px';
            root.style.height = height + 'px';
            
            root.style.position = 'absolute';
            root.style.top = '50%';
            root.style.left = '50%';
            root.style.transform = 'translate(-50%, -50%)';
        }
    };
})();



(function() {
    window.os = window.os || {};
    window.os.gui = window.os.gui || {};
    window.os.gui.titleBar = function(title, targetElement) {
        // Create root DOM element
        var titleBar = document.createElement('div');
        titleBar.className = 'titleBar';
        
        // Add title to span and append to titleBar
        var titleSpan = document.createElement('span');
        titleSpan.textContent = title;
        titleBar.appendChild(titleSpan);
        
        // Add button to titleBar
        var closeButton = document.createElement('button');
        closeButton.textContent = 'x';
        closeButton.addEventListener('click', function() {
            document.body.removeChild(targetElement);
        });
        titleBar.appendChild(closeButton);
        
        // Add drag and drop functionality to titleBar
        var dragging = false;
        var startX;
        var startY;
        var offsetX;
        var offsetY;
        
        titleBar.addEventListener('mousedown', function(e) {
            dragging = true;
            startX = e.clientX;
            startY = e.clientY;
            offsetX = targetElement.offsetLeft;
            offsetY = targetElement.offsetTop;
        });
        
        titleBar.addEventListener('mouseup', function() {
            dragging = false;
        });
        
        titleBar.addEventListener('mousemove', function(e) {
            if (dragging) {
                var x = e.clientX - startX;
                var y = e.clientY - startY;
                targetElement.style.left = (offsetX + x) + 'px';
                targetElement.style.top = (offsetY + y) + 'px';
            }
        });
        
        return titleBar;
    };
})();



(function() {
    if (!window.os) window.os = {};
    if (!window.os.gui) window.os.gui = {};
    if (!window.os.gui.utils) window.os.gui.utils = { setSizeAndCenter: setSizeAndCenter }; // Assuming this exists somewhere else in your code
    
    window.os.gui.createWindow = function(title = "Default Title", content = null, width = 400, height = 300) {
        var root = document.createElement("div");
        root.className = "window";
        
        window.os.gui.utils.setSizeAndCenter(root, width, height);
        
        var titlePlaceholder = document.createElement("div");
        titlePlaceholder.className = "titlePlaceholder";
        root.appendChild(titlePlaceholder);
        
        var toolbarPlaceholder = document.createElement("div");
        toolbarPlaceholder.className = "toolbarPlaceholder";
        root.appendChild(toolbarPlaceholder);
        
        var contentPlaceholder = document.createElement("div");
        contentPlaceholder.className = "contentPlaceholder";
        root.appendChild(contentPlaceholder);
        
        var statusPlaceholder = document.createElement("div");
        statusPlaceholder.className = "statusPlaceholder";
        root.appendChild(statusPlaceholder);
        
        if(typeof window.os.gui.titleBar === 'function') {
            var titleBar = window.os.gui.titleBar(title, root);
            titlePlaceholder.appendChild(titleBar);
        }
        
        if(content && content instanceof Node) {
            contentPlaceholder.appendChild(content);
        }
        
        var bringToFront = function() {
            var windows = document.querySelectorAll(".window");
            for(var i = 0; i < windows.length; i++) {
                windows[i].style.zIndex = 1;
            }
            root.style.zIndex = 2;
        }
        
        root.onclick = bringToFront;
        
        document.body.appendChild(root);
        
        setTimeout(bringToFront, 20);
        
        return root;
    }
})();



(function() {
    // Check if window.os exists and is an object
    if (typeof window.os === 'undefined' || typeof window.os !== 'object') {
        window.os = {};
    }
    
    // Check if window.os.gui exists and is an object
    if (typeof window.os.gui === 'undefined' || typeof window.os.gui !== 'object') {
        window.os.gui = {};
    }
    
    // Define the updateStatus function
    window.os.gui.updateStatus = function(win, value) {
        var statusElement = win.querySelector('.statusPlaceholder');
        if (statusElement !== null && statusElement !== undefined) {
            statusElement.innerText = value;
        } else {
            console.error('Element with class .statusPlaceholder not found in provided win DOM element');
        }
    };
})();



(function() {
    if (!window.os) window.os = {};
    if (!window.os.gui) window.os.gui = {};
    
    window.os.gui.toolbar = function(rootElement) {
        var toolbar = document.createElement('div');
        toolbar.className = 'toolbar';
        
        rootElement.querySelector('.toolbarPlaceholder').appendChild(toolbar);
        
        return {
            addButton: function(text, callback) {
                var button = document.createElement('button');
                button.textContent = text;
                button.addEventListener('click', callback);
                toolbar.appendChild(button);
            }
        };
    };
})();



(function() {
    if (!window.os) window.os = {};
    if (!window.os.gui) window.os.gui = {};
    
    window.os.gui.createPrompt = function(title, callback) {
        // create root dom element with class 'editor'
        var root = document.createElement('div');
        root.className = 'editor';
        
        // add text input element to root dom element full width
        var input = document.createElement('input');
        input.style.width = '100%';
        root.appendChild(input);
        
        // add button element to root dom element and set text to 'OK'
        var button = document.createElement('button');
        button.textContent = 'OK';
        root.appendChild(button);
        
        // call os.gui.createWindow with given parameters
        var win = window.os.gui.createWindow(title, root, 300, 100);
        
        // when button is clicked, call callback with input value and remove win element from body
        button.addEventListener('click', function() {
            callback(input.value);
            document.body.removeChild(win);
        });
    };
})();



(function() {
    if (!window.os) {
        window.os = {};
    }
    if (!window.os.gui) {
        window.os.gui = {};
    }
    window.os.gui.addIcon = function(name, icon, callback, container) {
        var root = document.createElement('div');
        root.classList.add('icon');
        
        var emoji = document.createElement('span');
        emoji.classList.add('emoji');
        emoji.textContent = icon;
        root.appendChild(emoji);
        
        var appName = document.createElement('span');
        appName.classList.add('app-name');
        appName.textContent = name;
        root.appendChild(appName);
        
        root.addEventListener('click', callback);
        
        container.appendChild(root);
    };
})();



(function() {
    window.os = window.os || {};
    window.os.apps = window.os.apps || {};
    
    window.os.apps.browser = function(path) {
        const root = document.createElement('div');
        root.className = 'browser';
        document.body.appendChild(root);
        
        const win = os.gui.createWindow('Browser', root);
        const toolbar = os.gui.toolbar(win);
        
        toolbar.addButton('📁', () => {
            os.gui.createPrompt('Enter folder name', name => {
                os.fs.mkdir(path, name);
                refresh();
            });
        });
        
        toolbar.addButton('📄', () => {
            os.gui.createPrompt('Enter file name', name => {
                os.fs.write(path + '/' + name, "");
                refresh();
            });
        });
        
        toolbar.addButton('🗑️', () => {
            os.fs.rm(path);
            path = path.substring(0, path.lastIndexOf('/'));
            refresh();
        });
        
        const refresh = () => {
            while (root.firstChild) {
                root.removeChild(root.firstChild);
            }
            
            os.gui.updateStatus(win, path);
            
            const files = os.fs.ls(path);
            
            if (path.length > 1) {
                os.gui.addIcon('..', '🔙', () => {
                    path = path.substring(0, path.lastIndexOf('/'));
                    refresh();
                }, root);
            }
            
            files.forEach(name => {
                const isFile = os.fs.isFile(path + '/' + name);
                
                const callback = isFile ? 
                    () => { os.apps.editor(path + '/' + name); refresh(); } : 
                    () => { path = path + '/' + name; refresh(); };
                
                os.gui.addIcon(name, isFile ? '📄' : '📁', callback, root);
            });
        };
        
        refresh();
    };
})();



(function() {
    window.os = window.os || {};
    window.os.apps = window.os.apps || {};
    
    window.os.apps.viewer = function(path) {
        var div = document.createElement('div');
        div.className = 'viewer';
        document.body.appendChild(div);
        
        window.os.gui.createWindow('View: ' + path, div);
        
        var content = window.os.fs.readPath(path);
        
        var pre = document.createElement('pre');
        pre.className = 'content';
        pre.innerHTML = content;
        div.appendChild(pre);
    };
})();



(function() {
    window.os = window.os || {};
    window.os.apps = window.os.apps || {};
    
    window.os.apps.minesweeper = function() {
        // create root dom element with class 'gmroot'
        let root = document.createElement('div');
        root.className = 'gmroot';
        document.body.appendChild(root);
        
        // generate matrix of 8x8 with values 0
        let matrix = Array(8).fill().map(() => Array(8).fill(0));
        
        // pick 3 random cells and set their value to 'x' and increase neighboring cells' values
        let mines = Array(3).fill().map(() => [Math.floor(Math.random() * 8), Math.floor(Math.random() * 8)]);
        mines.forEach(([x, y]) => {
            matrix[x][y] = 'x';
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    let nx = x + i, ny = y + j;
                    if (nx >= 0 && nx < 8 && ny >= 0 && ny < 8 && matrix[nx][ny] !== 'x') {
                        matrix[nx][ny]++;
                    }
                }
            }
        });
        
        // iterate through matrix and add div and button elements for each cell
        matrix.forEach((row, x) => {
            let div = document.createElement('div');
            row.forEach((value, y) => {
                let button = document.createElement('button');
                button.className = 'cell';
                button.textContent = '.';
                button.onclick = () => {
                    if (matrix[x][y] === 'x') {
                        button.textContent = '💣';
                        alert('You hit a mine 💣');
                    } else {
                        button.textContent = value;
                    }
                };
                div.appendChild(button);
            });
            root.appendChild(div);
        });
        
        // call os.gui.createWindow with parameters '💣 minesweeper', root DOM element, 250, 280
        window.os.gui.createWindow('💣 minesweeper', root, 250, 280);
    };
})();



(function() {
    window.os.apps.editor = function(path) {
        const root = document.createElement('div');
        root.className = 'editor';
        document.body.appendChild(root);
        
        const win = os.gui.createWindow('📄 Text Editor', root, 500, 500);
        const toolbar = os.gui.toolbar(win);
        toolbar.addButton('💾', save);
        
        const textarea = document.createElement('textarea');
        textarea.style.width = '100%';
        textarea.style.height = '100%';
        root.appendChild(textarea);
        
        let content = '';
        if (path) {
            content = os.fs.readPath(path);
            textarea.value = content;
        }
        
        function save() {
            if (path) {
                content = textarea.value;
                os.fs.write(path, content);
            } else {
                os.gui.createPrompt('Save File', (newPath) => {
                    os.fs.write(newPath, textarea.value);
                });
            }
        }
    };
})();


</script>
<style>
.titleBar {
    background-color: orange;
    border-bottom: 1px solid black;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: monospace;
    font-size: small;
    padding: 5px;
    user-select: none; /* This will prevent text selection */
}

/* This will apply styles to all buttons inside titleBar */
.titleBar button {
    border: 1px solid black;
    font-family: monospace;
    font-size: small;
    border-radius: 2px; /* This will give rounded corners */
}



.window {
    position: absolute;
    display: flex;
    flex-direction: column;
    background-color: white;
    padding: 1px;
    border: 2px solid black;
    border-radius: 4px;
}

.contentPlaceholder {
    flex-grow: 1;
    overflow: auto;
    padding: 5px;
}

.toolbarPlaceholder {
    border-bottom: 1px solid black;
}

.statusPlaceholder {
    border-top: 1px solid black;
    font-family: monospace;
    font-size: small;
}



.toolbar {
    padding: 3px 5px;
    margin-bottom: 2px;
    display: flex;
    justify-content: flex-start;
}

.toolbar button {
    border: none;
    cursor: pointer;
    background-color: white;
}

.toolbar button:hover {
    background-color: lightgray;
}



body {
    background-color: #2E393D;
}

.desktop {
    position: fixed;
    width: 100%;
    height: 100%;
}



.icon {
    width: 64px;
    height: 64px;
    text-align: center;
    margin: 5px;
    cursor: pointer;
}

.emoji {
    display: block;
    font-size: 30px;
}

.app-name {
    display: block;
    font-size: 8px;
    background-color: black;
    color: white;
    font-family: monospace;
    padding: 5px;
    word-wrap: break-word;
}



.browser {
    display: flex;
    flex-wrap: wrap;
}



.gmroot button {
    width: 30px;
    height: 30px;
    overflow: hidden;
}


</style>
</head>
<body>
<script>
(function() {
    os.gui.addIcon('Browser', '📁', () => os.apps.browser(''), document.body);
})();



(function() {
    os.gui.addIcon('Minesweeper', '💣', () => os.apps.minesweeper(), document.body);
})();



(function() {
    os.gui.addIcon('Text Editor', '📄', () => os.apps.editor(), document.body);
})();


</script>
</body>
</html>