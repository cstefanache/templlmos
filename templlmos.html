<html>
 <head>
  <style id="osbase_general-styles">
   body {
    background-color: #ffe4e1; /* This is a hexadecimal representation of a light pink color */
}
  </style>
  <script id="osbase_global-objects">
   (() => {
if (typeof window !== 'undefined') {
    window.os = {};
} else {
    console.error("This script is meant to run in a browser environment.");
}


})()
  </script>
  <script id="osbase_filesystem">
   (() => {
// Check if 'window.os' exists, if not, create it
if (typeof window.os === 'undefined') {
    window.os = {};
}

// Check if 'window.os.fs' exists, if not, create it
if (typeof window.os.fs === 'undefined') {
    window.os.fs = {};
}

// Load filesystem from localStorage if it exists, otherwise initialize it as an empty object
if (localStorage.getItem('filesystem')) {
    window.os.fs.filesystem = JSON.parse(localStorage.getItem('filesystem'));
} else {
    window.os.fs.filesystem = {};
}

// Sync filesystem to localStorage
window.os.fs.sync = function () {
    localStorage.setItem('filesystem', JSON.stringify(this.filesystem));
}

// Read path in filesystem
window.os.fs.readPath = function (path) {
    if (path[0] === '/') {
        path = path.substring(1);
    }
    var pathArray = path.split('/');
    var current = this.filesystem;
    for (var i = 0; i < pathArray.length; i++) {
        if (current[pathArray[i]] === undefined) {
            return undefined;
        } else {
            current = current[pathArray[i]];
        }
    }
    return current;
}

// Write content to path in filesystem and sync it
window.os.fs.write = function (path, content) {
    if (path[0] === '/') {
        path = path.substring(1);
    }
    var pathArray = path.split('/');
    var current = this.filesystem;
    for (var i = 0; i < pathArray.length - 1; i++) {
        if (current[pathArray[i]] === undefined) {
            current[pathArray[i]] = {};
        }
        current = current[pathArray[i]];
    }
    current[pathArray[pathArray.length - 1]] = content;
    this.sync();
}

// List entries in path in filesystem
window.os.fs.ls = function (path) {
    if (path === '') {
        return Object.keys(this.filesystem);
    } else {
        var content = this.readPath(path);
        if (typeof content === 'object') {
            return Object.keys(content);
        } else {
            return [];
        }
    }
}

// Create directory in filesystem and sync it
window.os.fs.mkdir = function (path, dirName) {
    this.write(path + '/' + dirName, {});
}

// Remove path in filesystem and sync it
window.os.fs.rm = function (path) {
    if (path[0] === '/') {
        path = path.substring(1);
    }
    var pathArray = path.split('/');
    var current = this.filesystem;
    for (var i = 0; i < pathArray.length - 1; i++) {
        if (current[pathArray[i]] === undefined) {
            return;
        } else {
            current = current[pathArray[i]];
        }
    }
    delete current[pathArray[pathArray.length - 1]];
    this.sync();
}

// Check if path in filesystem is a file (i.e., it's a string)
window.os.fs.isFile = function (path) {
    var content = this.readPath(path);
    return typeof content === 'string';
}


})()
  </script>
  <style id="desktop_content-style">
   #desktop_content {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow-y: hidden;
    padding: 10px;
    display: flex;
    flex-wrap: wrap;
    flex-direction: column;
    align-content: flex-start;
}
  </style>
  <style id="desktop_styles">
   .icon {
    width: 64px;
    min-height: 64px;
    text-align: center;
    margin: 5px;
    cursor: pointer;
}

.emoji {
    display: inline-block;
    font-size: 30px;
    position: relative;
}

.title {
    display: block;
    font-size: 8px;
    font-family: monospace;
    color: black;
    padding: 5px;
    word-wrap: break-word;
    border: 2px solid black;
    border-radius: 8px;
    background-color: white;
}
  </style>
  <script id="desktop_icon">
   (() => {
// Check if window.os exists, if not create it
if (!window.os) {
    window.os = {};
}

// Function to add icon to parent
window.os.icon = function(parent, emoji, title, callback) {
    // Create root DOM element
    var icon = document.createElement('div');
    icon.classList.add('icon');
    
    // Create span for emoji
    var emojiSpan = document.createElement('span');
    emojiSpan.classList.add('emoji');
    emojiSpan.textContent = emoji;
    
    // Create span for title
    var titleSpan = document.createElement('span');
    titleSpan.classList.add('title');
    titleSpan.textContent = title;
    
    // Append spans to icon
    icon.appendChild(emojiSpan);
    icon.appendChild(titleSpan);
    
    // Append icon to parent
    parent.appendChild(icon);
    
    // Add click event listener to icon
    icon.addEventListener('click', function() {
        // Callback when icon is clicked
        if (typeof callback === 'function') {
            callback();
        }
    });
};


})()
  </script>
  <script id="desktop_desktop-app">
   (() => {
// Assuming window.os exists and window.os.icon exists
if (!window.os) {
    window.os = {};
}

if (!window.os.addApp) {
    window.os.addApp = function (emoji, title, callback) {
        var parent = document.querySelector('#desktop_content');
        window.os.icon(parent, emoji, title, callback);
    };
}


})()
  </script>
  <style id="gui_gui-styles">
   .titleBar {
    background-color: orange;
    border-bottom: 1px solid black;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: monospace;
    font-size: small;
    padding: 5px;
    border-bottom: 2px solid black;
    user-select: none; /* This will prevent text selection */
}

/* This will apply styles to buttons inside titleBar */
.titleBar button {
    border: none;
    background: none;
    cursor: pointer;
    font-size: 6px;
    padding: 0;
}

.window {
    position: absolute;
    display: flex;
    flex-direction: column;
    background-color: white;
    padding: 0;
    border: 2px solid black;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 4px 4px 0 0 rgba(0,0,0,0.5);
}

.contentPlaceholder {
    flex-grow: 1;
    overflow: auto;
    padding: 5px;
}

.statusPlaceholder {
    border-top: 1px solid black;
    font-family: monospace;
    font-size: small;
}

.resizeHandle {
    width: 0px;
    height: 0px;
    position: absolute;
    bottom: 0;
    right: 0;
    cursor: se-resize;
    border-width: 0 0 10px 10px;
    border-style: solid;
    border-color: transparent transparent #ff7200 transparent;
    transform: rotate(0deg);
}

.toolbar {
    display: flex;
    justify-content: flex-start;
    padding: 2px;
    background-color: antiquewhite;
    margin-bottom: 2px;
    border-bottom: 1px solid black;
}

.toolbar button {
    border: none;
    cursor: pointer;
    background-color: transparent;
}
  </style>
  <script id="gui_draggable">
   (() => {
if (!window.os) {
    window.os = {};
}
if (!window.os.gui) {
    window.os.gui = {};
}

window.os.gui.makeDraggable = function (root, dragHandle) {
    var offsetX = 0;
    var offsetY = 0;
    
    dragHandle.addEventListener('mousedown', function (event) {
        offsetX = event.clientX - root.getBoundingClientRect().left;
        offsetY = event.clientY - root.getBoundingClientRect().top;
        
        document.addEventListener('mousemove', move);
        document.addEventListener('mouseup', drop);
    });
    
    function move (event) {
        event.preventDefault();
        root.style.position = 'absolute';
        root.style.left = event.clientX - offsetX + 'px';
        root.style.top = event.clientY - offsetY + 'px';
    }
    
    function drop () {
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', drop);
    }
};

// Add gui namespace if it doesn't exist
if (!window.os || !window.os.gui) {
    window.os = window.os || {};
    window.os.gui = {};
}

// Define makeResizable function
window.os.gui.makeResizable = function (root, resizeHandleDOMElement) {
    let rootRect = root.getBoundingClientRect();
    let startX = rootRect.width;
    let startY = rootRect.height;
    let startMouseX;
    let startMouseY;
    let startRootX = rootRect.x;
    let startRootY = rootRect.y;
    
    // Add event listeners for mousedown and mousemove events
    resizeHandleDOMElement.addEventListener('mousedown', function (e) {
        e.preventDefault();
        startMouseX = e.clientX;
        startMouseY = e.clientY;
        document.addEventListener('mousemove', mouseMove);
        document.addEventListener('mouseup', mouseUp);
    });
    
    // Define mouseMove function
    function mouseMove(e) {
        let diffX = e.clientX - startMouseX;
        let diffY = e.clientY - startMouseY;
        root.style.width = startX + diffX + 'px';
        root.style.height = startY + diffY + 'px';
    }
    
    // Define mouseUp function
    function mouseUp() {
        document.removeEventListener('mousemove', mouseMove);
        document.removeEventListener('mouseup', mouseUp);
        let rootRect = root.getBoundingClientRect();
        startX = rootRect.width;
        startY = rootRect.height;
        startRootX = rootRect.x;
        startRootY = rootRect.y;
    }
};

if (!window.os || !window.os.gui) {
    window.os = window.os || {};
    window.os.gui = window.os.gui || {};
}

window.os.gui.bringToFront = function (rootDomNode) {
    // Internal function to bring other nodes to front
    var bringOthersToFront = function () {
        // Get all nodes with same class as rootDomNode
        var nodes = document.getElementsByClassName(rootDomNode.className);
        // Iterate through them and set z-index to 0
        for (var i = 0; i < nodes.length; i++) {
            nodes[i].style.zIndex = 0;
        }
        // Set z-index of rootDomNode to 1
        rootDomNode.style.zIndex = 1;
    }
    
    // Add mousedown event listener to rootDomNode
    rootDomNode.addEventListener('mousedown', bringOthersToFront);
}


})()
  </script>
  <script id="gui_titleBar">
   (() => {
if (!window.os) window.os = {};
if (!window.os.gui) window.os.gui = {};

window.os.gui.titleBar = function(parentElement, title, close) {
    // Create root DOM element with class .titleBar
    var root = document.createElement('div');
    root.className = 'titleBar';
    
    // Add span containing title to root DOM element
    var span = document.createElement('span');
    span.textContent = title;
    root.appendChild(span);
    
    // Add button with text '❌' and class 'close' to root DOM element
    var button = document.createElement('button');
    button.textContent = '❌';
    button.className = 'close';
    button.addEventListener('click', close); // Add event listener for close callback
    root.appendChild(button);
    
    // Append root DOM element to parentElement
    parentElement.appendChild(root);
};


})()
  </script>
  <script id="gui_window">
   (() => {
window.os.gui.createWindow = function(emoji = "🖥️", title = "New Window", appCallback = () => {}, width = 400, height = 300) {
    // Create root DOM element
    let root = document.createElement("div");
    root.classList.add("window");
    document.body.appendChild(root);
    
    // Bring window to front
    window.os.gui.bringToFront(root);
    
    // Create placeholders for title bar, toolbar, content, status
    let titlePlaceholder = document.createElement("div");
    titlePlaceholder.classList.add("titlePlaceholder");
    root.appendChild(titlePlaceholder);
    
    let toolbarPlaceholder = document.createElement("div");
    toolbarPlaceholder.classList.add("toolbarPlaceholder");
    root.appendChild(toolbarPlaceholder);
    
    let contentPlaceholder = document.createElement("div");
    contentPlaceholder.classList.add("contentPlaceholder");
    root.appendChild(contentPlaceholder);
    
    let statusPlaceholder = document.createElement("div");
    statusPlaceholder.classList.add("statusPlaceholder");
    root.appendChild(statusPlaceholder);
    
    // Create resize handle
    let resizeHandle = document.createElement("div");
    resizeHandle.classList.add("resizeHandle");
    root.appendChild(resizeHandle);
    
    // Create title bar
    window.os.gui.titleBar(titlePlaceholder, emoji + " " + title, () => { document.body.removeChild(root); });
    
    // Append appCallback to content placeholder
    contentPlaceholder.appendChild(appCallback(root));
    
    // Make window draggable by title placeholder
    window.os.gui.makeDraggable(root, titlePlaceholder);
    
    // Make window resizable by resize handle
    window.os.gui.makeResizable(root, resizeHandle);
    
    // Set width and height of root element
    root.style.width = width + "px";
    root.style.height = height + "px";
    
    return root;
};


})()
  </script>
  <script id="gui_toolbar">
   (() => {
// Assuming window.os is already defined as an object
if (!window.os) {
    window.os = {};
}
if (!window.os.gui) {
    window.os.gui = {};
}

// Function to create toolbar
window.os.gui.createToolbar = function(parent) {
    // Create root DOM element
    var toolbar = document.createElement('div');
    toolbar.className = 'toolbar';
    
    // Append to parent's .toolbarPlaceholder
    var toolbarPlaceholder = parent.querySelector('.toolbarPlaceholder');
    toolbarPlaceholder.appendChild(toolbar);
    
    // Return object with addButton function
    return {
        addButton: function(text, callback) {
            // Create button DOM element
            var button = document.createElement('button');
            button.textContent = text;
            
            // Append to toolbar
            toolbar.appendChild(button);
            
            // Add click event listener to call callback
            button.addEventListener('click', callback);
        }
    };
};


})()
  </script>
  <script id="apps_app">
   (() => {
// Assuming window.os exists and has methods window.os.addApp and window.os.gui.createWindow
if (!window.os) {
    window.os = {};
}

if (!window.os.addApp) {
    window.os.addApp = function(emoji, title, callback) {
        // Assuming this function adds application to OS
    };
}

if (!window.os.gui) {
    window.os.gui = {};
}

if (!window.os.gui.createWindow) {
    window.os.gui.createWindow = function(title, emoji, callback, width=400, height=400) {
        // Assuming this function creates a window with given parameters
        // And returns HTMLElement
    };
}

// New registerApplication function
if (!window.os.registerApplication) {
    window.os.registerApplication = function(title, emoji, callback, width=400, height=400) {
        const initialize = () => {
            window.os.gui.createWindow(title, emoji, callback, width, height);
        };
        window.os.addApp(emoji, title, initialize);
        return null;  // or you can return anything you want
    };
}


})()
  </script>
 </head>
 <body>
  <div id="desktop_content">
  </div>
  <script id="gui_gui-tests">
   (() => {

})()
  </script>
  <script id="apps_hello-world">
   (() => {
function helloWorld() {
    // Create a root dom element with class 'hw'
    let rootElement = document.createElement('div');
    rootElement.className = 'hw';
    
    // Create a new 'h1' element with the text 'Hello, World!' and appends it to the root element
    let h1Element = document.createElement('h1');
    h1Element.textContent = 'Hello, World!';
    rootElement.appendChild(h1Element);
    
    // Return root dom element
    return rootElement;
}

// Register application with 'hello world' title, 👋 as emoji, helloWorld function and 300x200 size 
if (typeof window.os !== 'undefined' && typeof window.os.registerApplication === 'function') {
    window.os.registerApplication('hello world', '👋', helloWorld, 300, 200);
} else {
    console.error('The os or registerApplication does not exist');
}


})()
  </script>
  <script id="apps_browser">
   (() => {
function browser(parent) {
    var browserPath = '';
    var root = document.createElement('div');
    root.className = 'browser';
    parent.appendChild(root);
    
    var load = function(path) {
        browserPath = path;
        while (root.firstChild) {
            root.removeChild(root.firstChild);
        }
        if (browserPath !== '') {
            var upButton = document.createElement('div');
            upButton.textContent = '..';
            upButton.addEventListener('click', function() {load(browserPath.split('/').slice(0, -1).join('/'));});
            root.appendChild(upButton);
        }
        window.os.fs.ls(browserPath).forEach(function(entry) {
            var entryDiv = document.createElement('div');
            entryDiv.textContent = entry;
            entryDiv.addEventListener('click', function() {
                if (!window.os.fs.isFile(browserPath + '/' + entry)) {
                    load(browserPath + '/' + entry);
                }
            });
            root.appendChild(entryDiv);
        });
    };
    load(browserPath);
    
    var toolbar = window.os.gui.createToolbar(parent);
    toolbar.addButton('📁', function() {
        var dirName = prompt('Enter directory name');
        if (dirName) {
            window.os.fs.mkdir(browserPath, dirName);
            load(browserPath);
        }
    });
    toolbar.addButton('📄', function() {
        var fileName = prompt('Enter file name');
        if (fileName) {
            window.os.fs.write(browserPath + '/' + fileName, '');
            load(browserPath);
        }
    });
    
    return root;
}

window.os.registerApplication('Browser', '📂', browser, 400, 400);


})()
  </script>
 </body>
</html>
