<html>
 <head>
  <style id="osbase_general-styles">
   body {
    background-color: #2E393D;
}
  </style>
  <script id="osbase_global-objects">
   (() => {
window.os = {};


})()
  </script>
  <script id="osbase_filesystem">
   (() => {
if (!window.os) {
    window.os = {};
}
if (!window.os.fs) {
    window.os.fs = {
        filesystem: {},
        sync: function () {
            window.localStorage.setItem('filesystem', JSON.stringify(this.filesystem));
        },
        readPath: function (path) {
            if (path[0] === '/') {
                path = path.substring(1);
            }
            let parts = path.split('/');
            let obj = this.filesystem;
            for (let part of parts) {
                if (obj[part] === undefined) {
                    return undefined;
                } else {
                    obj = obj[part];
                }
            }
            return obj;
        },
        write: function (path, content) {
            if (path[0] === '/') {
                path = path.substring(1);
            }
            let parts = path.split('/');
            let obj = this.filesystem;
            for (let i = 0; i < parts.length - 1; i++) {
                if (obj[parts[i]] === undefined) {
                    obj[parts[i]] = {};
                }
                obj = obj[parts[i]];
            }
            obj[parts[parts.length - 1]] = content;
            this.sync();
        },
        ls: function (path = '') {
            if (path[0] === '/') {
                path = path.substring(1);
            }
            let obj = this.filesystem;
            if (path !== '') {
                let parts = path.split('/');
                for (let part of parts) {
                    if (obj[part] === undefined) {
                        return undefined;
                    } else {
                        obj = obj[part];
                    }
                }
            }
            return Object.keys(obj);
        },
        mkdir: function (path, dirName) {
            if (path[0] === '/') {
                path = path.substring(1);
            }
            let parts = path.split('/');
            let obj = this.filesystem;
            for (let i = 0; i < parts.length - 1; i++) {
                if (obj[parts[i]] === undefined) {
                    obj[parts[i]] = {};
                }
                obj = obj[parts[i]];
            }
            obj[dirName] = {};
            this.sync();
        },
        rm: function (path) {
            if (path[0] === '/') {
                path = path.substring(1);
            }
            let parts = path.split('/');
            let obj = this.filesystem;
            let parent = obj;
            for (let i = 0; i < parts.length - 1; i++) {
                if (obj[parts[i]] === undefined) {
                    return;
                } else {
                    parent = obj;
                    obj = obj[parts[i]];
                }
            }
            delete parent[parts[parts.length - 1]];
            this.sync();
        },
        isFile: function (path) {
            if (path[0] === '/') {
                path = path.substring(1);
            }
            let parts = path.split('/');
            let obj = this.filesystem;
            for (let part of parts) {
                if (obj[part] === undefined || typeof obj[part] !== 'string') {
                    return false;
                } else {
                    obj = obj[part];
                }
            }
            return true;
        }
    };
}


})()
  </script>
  <style id="gui_gui-styles">
   .titleBar {
    background-color: orange;
    border-bottom: 1px solid black;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: monospace;
    font-size: small;
    padding: 5px;
    user-select: none; /* This will prevent text selection */
}

/* This will apply styles to buttons inside the title bar */
.titleBar button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 6;
    padding: 0; /* This will remove default button padding */
}

.window {
    position: absolute;
    display: flex;
    flex-direction: column;
    background-color: white;
    padding: 1px;
    border: 2px solid black;
    border-radius: 4px;
}

.contentPlaceholder {
    flex-grow: 1;
    overflow: auto;
    padding: 5px;
}

.toolbarPlaceholder {
    border-bottom: 1px solid black;
}

.statusPlaceholder {
    border-top: 1px solid black;
    font-family: monospace;
    font-size: small;
}

.resizeHandle {
    width: 10px;
    height: 10px;
    position: absolute;
    bottom: 0;
    right: 0;
    cursor: se-resize;
    background-color: #000; /* Change this to your desired handle color */
}
  </style>
  <script id="gui_gui-global-objects">
   (() => {
if (typeof window.os === 'undefined') {
    window.os = {};
}

window.os.gui = {};


})()
  </script>
  <script id="gui_draggable">
   (() => {
// Assuming window.os is already defined and has a gui property
if (!window.os) {
    window.os = {};
}
if (!window.os.gui) {
    window.os.gui = {};
}

// Define makeDraggable function
window.os.gui.makeDraggable = function (root, dragHandle) {
    let offsetX = 0;
    let offsetY = 0;
    let mouseX = 0;
    let mouseY = 0;
    
    const handleMouseDown = function (e) {
        e = e || window.event;
        mouseX = e.clientX;
        mouseY = e.clientY;
        offsetX = root.offsetLeft - mouseX;
        offsetY = root.offsetTop - mouseY;
        
        document.onmouseup = function () {
            document.onmousemove = null;
            document.onmouseup = null;
        };
        
        document.onmousemove = function (e) {
            e = e || window.event;
            mouseX = e.clientX;
            mouseY = e.clientY;
            root.style.left = (mouseX + offsetX) + 'px';
            root.style.top = (mouseY + offsetY) + 'px';
        };
    };
    
    dragHandle.onmousedown = handleMouseDown;
};

// Assuming window.os exists and has a gui property
if (!window.os) {
    window.os = {};
}
if (!window.os.gui) {
    window.os.gui = {};
}

// Define makeResizable function
window.os.gui.makeResizable = function(root, resizeHandle) {
    let startX;
    let startY;
    let startWidth = root.offsetWidth;
    let startHeight = root.offsetHeight;
    
    // Handle mousedown event to start resizing
    resizeHandle.addEventListener('mousedown', function(e) {
        e.preventDefault();
        startX = e.clientX;
        startY = e.clientY;
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    // Handle mousemove event to resize element
    function handleMouseMove(e) {
        let width = startWidth + e.clientX - startX;
        let height = startHeight + e.clientY - startY;
        
        root.style.width = width + 'px';
        root.style.height = height + 'px';
    }
    
    // Handle mouseup event to stop resizing and update starting width and height
    function handleMouseUp() {
        startWidth = root.offsetWidth;
        startHeight = root.offsetHeight;
        
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
};

if (!window.os || !window.os.gui) {
    window.os = window.os || {};
    window.os.gui = window.os.gui || {};
}

window.os.gui.bringToFront = function (rootDomNode) {
    // Internal function to bring other nodes to front
    var bringOthersToFront = function () {
        // Get all nodes with same class as rootDomNode
        var nodes = document.getElementsByClassName(rootDomNode.className);
        // Iterate through them and set z-index to 0
        for (var i = 0; i < nodes.length; i++) {
            nodes[i].style.zIndex = 0;
        }
        // Set z-index of rootDomNode to 1
        rootDomNode.style.zIndex = 1;
    }
    
    // Add mousedown event listener to rootDomNode
    rootDomNode.addEventListener('mousedown', bringOthersToFront);
}


})()
  </script>
  <script id="gui_titleBar">
   (() => {
if (!window.os) window.os = {};
if (!window.os.gui) window.os.gui = {};

window.os.gui.titleBar = function(parentElement, title) {
    // Create root DOM element with class .titleBar
    var root = document.createElement('div');
    root.className = 'titleBar';
    
    // Add span containing title to root DOM element
    var span = document.createElement('span');
    span.textContent = title;
    root.appendChild(span);
    
    // Add button with text '‚ùå' to root DOM element
    var button = document.createElement('button');
    button.textContent = '‚ùå';
    button.addEventListener('click', function() {
        // When button is clicked, remove parentElement from DOM
        var parent = parentElement.parentNode;
        if(parent){
            parent.removeChild(parentElement);
        }
    });
    root.appendChild(button);
    
    // Append root DOM element to parentElement
    parentElement.appendChild(root);
};


})()
  </script>
  <script id="gui_window">
   (() => {
// Check if window.os and window.os.gui exist, create them if not
if (!window.os) {
    window.os = {};
}
if (!window.os.gui) {
    window.os.gui = {};
}

// Define createWindow function
window.os.gui.createWindow = function (emoji = 'üñ•Ô∏è', title = 'New Window', content = null, width = 400, height = 300) {
    // Create root DOM element with class .window and add it to document body
    const root = document.createElement('div');
    root.classList.add('window');
    document.body.appendChild(root);
    
    // Call bringToFront on root element
    window.os.gui.bringToFront(root);
    
    // Add and empty div with class titlePlaceholder to root DOM element
    const titlePlaceholder = document.createElement('div');
    titlePlaceholder.classList.add('titlePlaceholder');
    root.appendChild(titlePlaceholder);
    
    // Add and empty div with class toolbarPlaceholder to root DOM element
    const toolbarPlaceholder = document.createElement('div');
    toolbarPlaceholder.classList.add('toolbarPlaceholder');
    root.appendChild(toolbarPlaceholder);
    
    // Add and empty div with class contentPlaceholder to root DOM element and append content parameter to it
    const contentPlaceholder = document.createElement('div');
    contentPlaceholder.classList.add('contentPlaceholder');
    root.appendChild(contentPlaceholder);
    if (content !== null) {
        contentPlaceholder.appendChild(content);
    }
    
    // Add and empty div with class statusPlaceholder to root DOM element
    const statusPlaceholder = document.createElement('div');
    statusPlaceholder.classList.add('statusPlaceholder');
    root.appendChild(statusPlaceholder);
    
    // Add resize handle to root DOM element with class resizeHandle
    const resizeHandle = document.createElement('div');
    resizeHandle.classList.add('resizeHandle');
    root.appendChild(resizeHandle);
    
    // Add titleBar to titlePlaceholder having text emoji + title
    window.os.gui.titleBar(titlePlaceholder, emoji + ' ' + title);
    
    // Call makeDraggable on root element by the titlePlaceholder element
    window.os.gui.makeDraggable(root, titlePlaceholder);
    
    // Make root element resizable by resizeHandle element
    window.os.gui.makeResizable(root, resizeHandle);
    
    // Set default width and height of root element
    root.style.width = width + 'px';
    root.style.height = height + 'px';
    
    // Return null
    return null;
}


})()
  </script>
 </head>
 <body>
  <script id="gui_gui-tests">
   (() => {
// Create a new div and set its properties
let div = document.createElement('div');
div.style.position = 'absolute';
div.style.width = '100px';
div.style.height = '100px';
div.style.backgroundColor = 'red';
document.body.appendChild(div);

// Create another div and set its properties and append it to the first div
let div2 = document.createElement('div');
div2.style.position = 'relative';
div2.style.width = '100%';
div2.style.height = '20px';
div2.style.backgroundColor = 'blue';
div.appendChild(div2);

// Create another div and set its properties and append it to the first div
let div3 = document.createElement('div');
div3.style.position = 'absolute';
div3.style.right = '0';
div3.style.bottom = '0';
div3.style.width = '10px';
div3.style.height = '10px';
div3.style.backgroundColor = 'green';
div.appendChild(div3);

// Make the first div draggable using the second div as the drag handle
if (!window.os || !window.os.gui || !window.os.gui.makeDraggable) {
    window.os = window.os || {};
    window.os.gui = window.os.gui || {};
    window.os.gui.makeDraggable = (function() {
        var startX, startY, startLeft, startTop;
        return function(root, dragHandle) {
            var rect = root.getBoundingClientRect();
            startLeft = rect.left;
            startTop = rect.top;
            dragHandle.addEventListener('mousedown', function(e) {
                startX = e.clientX;
                startY = e.clientY;
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', up);
            });
            function move(e) {
                var left = startLeft + e.clientX - startX;
                var top = startTop + e.clientY - startY;
                root.style.left = left + 'px';
                root.style.top = top + 'px';
            }
            function up() {
                document.removeEventListener('mousemove', move);
                document.removeEventListener('mouseup', up);
            }
        };
    })();
}
window.os.gui.makeDraggable(div, div2);

// Make the first div resizable using the third div as the resize handle
if (!window.os || !window.os.gui || !window.os.gui.makeResizable) {
    window.os = window.os || {};
    window.os.gui = window.os.gui || {};
    window.os.gui.makeResizable = (function() {
        var startWidth, startHeight;
        return function(root, resizeHandle) {
            var rect = root.getBoundingClientRect();
            startWidth = rect.width;
            startHeight = rect.height;
            resizeHandle.addEventListener('mousedown', function(e) {
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', up);
            });
            function move(e) {
                var width = startWidth + e.clientX - resizeHandle.getBoundingClientRect().left;
                var height = startHeight + e.clientY - resizeHandle.getBoundingClientRect().top;
                root.style.width = width + 'px';
                root.style.height = height + 'px';
            }
            function up() {
                document.removeEventListener('mousemove', move);
                document.removeEventListener('mouseup', up);
            }
        };
    })();
}
window.os.gui.makeResizable(div, div3);


})()
  </script>
  <script id="gui_window-tests">
   (() => {
// Create first window
let div1 = document.createElement('div');
div1.innerHTML = 'hello world 1';
let win1 = window.os.gui.createWindow('üòÉ', 'My Window', div1);

// Create second window
let div2 = document.createElement('div');
div2.innerHTML = 'hello world 2';
let win2 = window.os.gui.createWindow('üíÑ', 'My Window 2', div2);


})()
  </script>
 </body>
</html>
